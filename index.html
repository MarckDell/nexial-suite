<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexial Suite - Sistema Empresarial Integral</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="pwa-manifest.json">
    <style>
        /* ============================================= */
        /* REGIÓN: VARIABLES GLOBALES */
        /* ============================================= */
        :root {
            --primary: #7c3aed;
            --primary-glow: #9d5bff;
            --secondary: #00f5ff;
            --accent: #ffd700;
            --success: #00ff41;
            --danger: #ff0055;
            --warning: #ffaa00;
            --info: #00aaff;
            
            --dark: #0f0f23;
            --darker: #070710;
            --card-bg: rgba(15, 15, 35, 0.8);
            --glass: rgba(255, 255, 255, 0.05);
            
            --neon-shadow: 0 0 15px;
        }
        
        /* ============================================= */
        /* MÓDULO: RESET Y BASE */
        /* ============================================= */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            background: var(--darker);
            color: #f0f0ff;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(124, 58, 237, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 245, 255, 0.1) 0%, transparent 20%);
            overflow-x: hidden;
        }
        
        /* ============================================= */
        /* COMPONENTE: HEADER CYBERPUNK */
        /* ============================================= */
        .cyber-header {
            background: rgba(15, 15, 35, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(124, 58, 237, 0.3);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideDown 0.8s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .cyber-logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                text-shadow: 0 0 10px rgba(124, 58, 237, 0.5),
                             0 0 20px rgba(124, 58, 237, 0.3);
            }
            to {
                text-shadow: 0 0 20px rgba(124, 58, 237, 0.8),
                             0 0 30px rgba(124, 58, 237, 0.6),
                             0 0 40px rgba(124, 58, 237, 0.4);
            }
        }
        
        .cyber-nav { 
            display: flex; 
            gap: 2rem; 
        }
        
        .cyber-nav a {
            color: #cbd5e1;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .cyber-nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(124, 58, 237, 0.2), transparent);
            transition: 0.5s;
        }
        
        .cyber-nav a:hover::before { left: 100%; }
        .cyber-nav a:hover {
            background: rgba(124, 58, 237, 0.2);
            color: var(--secondary);
            transform: translateY(-2px);
        }
        
        /* ============================================= */
        /* COMPONENTE: BOTONES CYBERPUNK */
        /* ============================================= */
        .cyber-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .cyber-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .cyber-btn:hover::before { left: 100%; }
        .cyber-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--neon-shadow) rgba(124, 58, 237, 0.5);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        /* ============================================= */
        /* SECCIÓN: HERO PRINCIPAL */
        /* ============================================= */
        .cyber-hero {
            padding: 12rem 2rem 6rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .cyber-hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.1) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.6;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }
        
        .cyber-hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(124, 58, 237, 0.3);
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .cyber-subtitle {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 2rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.5s both;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ============================================= */
        /* MÓDULO: TARJETAS DE CARACTERÍSTICAS */
        /* ============================================= */
        .cyber-features {
            padding: 6rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .cyber-card {
            background: rgba(15, 15, 35, 0.8);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(124, 58, 237, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .cyber-card:nth-child(1) { animation-delay: 0.1s; }
        .cyber-card:nth-child(2) { animation-delay: 0.2s; }
        .cyber-card:nth-child(3) { animation-delay: 0.3s; }
        .cyber-card:nth-child(4) { animation-delay: 0.4s; }
        
        .cyber-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(124, 58, 237, 0.1), transparent);
            transition: 0.5s;
        }
        
        .cyber-card:hover::before { left: 100%; }
        .cyber-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: 0 15px 30px rgba(124, 58, 237, 0.2),
                        0 0 50px rgba(124, 58, 237, 0.1);
        }
        
        .cyber-card h3 {
            color: var(--secondary);
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .cyber-card ul {
            margin-top: 1rem;
            padding-left: 1.5rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .cyber-card li {
            margin-bottom: 0.5rem;
        }
        
        /* ============================================= */
        /* SECCIÓN: FORMULARIOS */
        /* ============================================= */
        .cyber-form {
            background: rgba(15, 15, 35, 0.8);
            padding: 2.5rem;
            border-radius: 15px;
            border: 1px solid rgba(0, 245, 255, 0.3);
            max-width: 500px;
            margin: 0 auto;
            animation: scaleIn 0.6s ease-out;
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--secondary);
            font-weight: 500;
        }
        
        .form-group input, 
        .form-group select {
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(124, 58, 237, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 12px;
            padding-right: 2.5rem;
            cursor: pointer;
        }
        
        .form-group input {
            background-image: none;
            padding-right: 1rem;
            cursor: text;
        }
        
        /* Estilos específicos para select - VISIBLE Y NÍTIDO */
        .form-group select option {
            background: rgba(15, 15, 35, 1) !important;
            color: white !important;
            padding: 12px !important;
            font-size: 1rem !important;
            border-bottom: 1px solid rgba(124, 58, 237, 0.3) !important;
        }
        
        .form-group select option:hover,
        .form-group select option:focus,
        .form-group select option:checked {
            background: rgba(124, 58, 237, 0.4) !important;
            color: var(--secondary) !important;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(124, 58, 237, 0.3),
                        0 0 20px rgba(124, 58, 237, 0.1);
        }
        
        /* Firefox */
        @-moz-document url-prefix() {
            .form-group select {
                color: white !important;
                text-shadow: 0 0 0 white;
            }
            .form-group select option {
                background: rgba(15, 15, 35, 1) !important;
                color: white !important;
            }
        }
        
        .password-wrapper {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--secondary);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 2;
        }
        
        .toggle-password:hover {
            color: var(--primary);
            transform: translateY(-50%) scale(1.1);
        }
        
        /* ============================================= */
        /* COMPONENTE: BANNERS DE INFORMACIÓN */
        /* ============================================= */
        .info-banner {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid var(--secondary);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            animation: neonGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes neonGlow {
            from {
                box-shadow: 0 0 10px rgba(0, 245, 255, 0.3),
                            inset 0 0 10px rgba(0, 245, 255, 0.1);
            }
            to {
                box-shadow: 0 0 20px rgba(0, 245, 255, 0.6),
                            inset 0 0 20px rgba(0, 245, 255, 0.2);
            }
        }
        
        .warning-box {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid var(--accent);
            padding: 1rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            text-align: center;
            animation: pulseWarning 2s ease-in-out infinite;
        }
        
        @keyframes pulseWarning {
            0%, 100% {
                border-color: var(--accent);
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
            }
            50% {
                border-color: #ffed4e;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            }
        }
        
        .protection-banner {
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid var(--success);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
            animation: successPulse 2s ease-in-out infinite;
        }
        
        @keyframes successPulse {
            0%, 100% {
                border-color: var(--success);
                box-shadow: 0 0 15px rgba(0, 255, 65, 0.2);
            }
            50% {
                border-color: #00ffaa;
                box-shadow: 0 0 25px rgba(0, 255, 65, 0.4);
            }
        }
        
        /* ============================================= */
        /* SECCIÓN: FOOTER */
        /* ============================================= */
        .cyber-footer {
            background: rgba(7, 7, 16, 0.95);
            padding: 4rem 2rem 2rem;
            border-top: 1px solid rgba(124, 58, 237, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .cyber-footer::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            animation: scanline 3s linear infinite;
        }
        
        @keyframes scanline {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* ============================================= */
        /* MÓDULO: MODALES CYBERPUNK */
        /* ============================================= */
        .cyber-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(7, 7, 16, 0.98);
            backdrop-filter: blur(10px);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
            overflow-y: auto;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                backdrop-filter: blur(0);
            }
            to {
                opacity: 1;
                backdrop-filter: blur(10px);
            }
        }
        
        .modal-content {
            background: rgba(15, 15, 35, 0.95);
            padding: 2.5rem;
            border-radius: 20px;
            border: 1px solid rgba(124, 58, 237, 0.4);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5),
                        0 0 100px rgba(124, 58, 237, 0.1);
            animation: modalSlideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            z-index: 10;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(124, 58, 237, 0.3);
            position: relative;
        }
        
        .modal-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }
        
        .modal-header h2 {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        
        /* ============================================= */
        /* COMPONENTE: PARTÍCULAS DE FONDO */
        /* ============================================= */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: rgba(124, 58, 237, 0.2);
            border-radius: 50%;
            animation: floatParticle 20s infinite linear;
        }
        
        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Estilos para el contenedor de teléfono con código de país */
        .phone-container {
            display: flex;
            gap: 0.5rem;
        }
        
        .country-code {
            flex: 0 0 100px;
        }
        
        .phone-number {
            flex: 1;
        }
        
        /* Estilos para grid de 2 columnas */
        .name-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        /* Estilos para checkbox mejorado */
        .checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(124, 58, 237, 0.2);
            transition: all 0.3s;
        }
        
        .checkbox-container:hover {
            background: rgba(124, 58, 237, 0.05);
            border-color: rgba(124, 58, 237, 0.4);
        }
        
        .checkbox-container input[type="checkbox"] {
            margin-top: 0.25rem;
            min-width: 18px;
            min-height: 18px;
            accent-color: var(--primary);
        }
        
        .checkbox-container label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
            cursor: pointer;
        }
        
        .checkbox-container label a {
            color: var(--secondary);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .checkbox-container label a:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        /* ============================================= */
        /* MEDIA QUERIES - RESPONSIVE */
        /* ============================================= */
        @media (max-width: 768px) {
            .cyber-hero h1 { font-size: 2.5rem; }
            .cyber-nav { display: none; }
            .features-grid { grid-template-columns: 1fr; }
            .modal-content { padding: 1.5rem; }
            .form-actions { flex-direction: column; }
            .phone-container { flex-direction: column; }
            .country-code { flex: 1; }
            .checkbox-container { flex-direction: column; }
            .name-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 480px) {
            .cyber-header { padding: 1rem; }
            .cyber-hero { padding: 8rem 1rem 4rem; }
            .cyber-features { padding: 3rem 1rem; }
        }
        
        /* Estilos para loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(7, 7, 16, 0.95);
            backdrop-filter: blur(10px);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(124, 58, 237, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Mensajes de alerta */
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }
        
        .alert-success {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .alert-error {
            background: rgba(255, 0, 85, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        
        /* Nuevos estilos para IDs profesionales */
        .professional-id {
            font-family: 'Courier New', monospace;
            background: rgba(124, 58, 237, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            border: 1px solid rgba(124, 58, 237, 0.3);
            font-size: 0.9rem;
        }
        
        .company-code-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .code-coc { background: #ff4444; color: white; }
        .code-dlx { background: #44ff44; color: #000; }
        .code-hpp { background: #4444ff; color: white; }
        .code-nex { background: #ff44ff; color: white; }
    </style>
</head>
<body>
    <!-- BLOQUE: PARTÍCULAS DE FONDO -->
    <div class="particles" id="particles"></div>
    
    <!-- BLOQUE: LOADING GLOBAL -->
    <div class="loading" id="globalLoading">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: var(--secondary);">Procesando...</p>
    </div>
    
    <!-- BLOQUE: HEADER PRINCIPAL -->
    <header class="cyber-header">
        <div class="cyber-logo">
            <i class="fas fa-brain"></i>
            NEXIAL SUITE
        </div>
        <nav class="cyber-nav">
            <a href="#inicio">Inicio</a>
            <a href="#caracteristicas">Sistema</a>
            <a href="#ventajas">Ventajas</a>
            <a href="#" onclick="openRegisterModal()">Registro</a>
        </nav>
        <button class="cyber-btn" onclick="openLoginModal()">
            <i class="fas fa-sign-in-alt"></i> Acceso
        </button>
    </header>

    <!-- BLOQUE: SECCIÓN HERO -->
    <section class="cyber-hero" id="inicio">
        <h1>Transforma tu Gestión Empresarial</h1>
        <p class="cyber-subtitle">
            Sistema integral multiempresa. Control total, máxima eficiencia.
            Apps para ventas, distribución y almacenes en tiempo real.
        </p>
        <button class="cyber-btn" style="padding: 1.2rem 2.5rem; font-size: 1.1rem;" onclick="openRegisterModal()">
            <i class="fas fa-rocket"></i> COMENZAR PRUEBA GRATUITA
        </button>
    </section>

    <!-- BLOQUE: CARACTERÍSTICAS DEL SISTEMA -->
    <section class="cyber-features" id="caracteristicas">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h2 style="color: var(--secondary); font-size: 2.5rem; animation: fadeInUp 1s ease-out;">SISTEMA POR ÁREAS ESPECIALIZADAS</h2>
            <p style="opacity: 0.8;">Cada área con funciones específicas y control total</p>
        </div>
        
        <div class="features-grid">
            <div class="cyber-card">
                <h3><i class="fas fa-crown"></i> DIRECCIÓN EJECUTIVA</h3>
                <p>Control total de su empresa. Panel ejecutivo completo con visibilidad de todas las áreas.</p>
                <ul>
                    <li>Supervisión todas las áreas</li>
                    <li>Reportes consolidados en tiempo real</li>
                    <li>Gestión estratégica y toma de decisiones</li>
                    <li>Control financiero completo</li>
                    <li>Monitoreo de producción y ventas</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-chart-line"></i> DIRECCIÓN COMERCIAL</h3>
                <p>Ventas, inventario, rutas y gestión comercial especializada con apps móviles.</p>
                <ul>
                    <li>Asignación de zonas geográficas a vendedores</li>
                    <li>Control de inventario en tiempo real</li>
                    <li>Optimización de rutas de distribución</li>
                    <li>Seguimiento de pedidos GPS</li>
                    <li>Mapas y geolocalización avanzada</li>
                    <li>Asignación de productos a vendedores</li>
                    <li>Aprobación de clientes y pedidos</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-calculator"></i> ADMINISTRACIÓN & FINANZAS</h3>
                <p>Contabilidad, nómina, facturación y gestión financiera completa.</p>
                <ul>
                    <li>Gestión de usuarios y empleados</li>
                    <li>Recursos humanos completo</li>
                    <li>Contabilidad automatizada</li>
                    <li>Facturación electrónica</li>
                    <li>Cálculo de comisiones y sueldos</li>
                    <li>Gestión de proveedores</li>
                    <li>Reportes financieros detallados</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-mobile-alt"></i> APPS ESPECIALIZADAS</h3>
                <p>Aplicaciones móviles para cada función operativa.</p>
                <ul>
                    <li>App Vendedor: Pedidos en campo</li>
                    <li>App Almacén: Control de inventario</li>
                    <li>App Distribuidor: Rutas y entregas</li>
                    <li>Trabajo offline con sincronización</li>
                    <li>Notificaciones push en tiempo real</li>
                    <li>Fotos y firmas digitales</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- BLOQUE: SECCIÓN DE VENTAJAS -->
    <section class="cyber-features" id="ventajas" style="background: var(--dark);">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h2 style="color: var(--accent); font-size: 2.5rem;">VENTAJAS DEL SISTEMA</h2>
            <p style="opacity: 0.8;">Todo lo que necesitas en una sola plataforma</p>
        </div>
        
        <div class="features-grid">
            <div class="cyber-card">
                <h3><i class="fas fa-sync-alt"></i> TIEMPO REAL</h3>
                <p>Todas las áreas actualizadas al instante. Lo que ve el vendedor en campo lo ve el jefe en su oficina.</p>
                <ul>
                    <li>Ventas registradas al instante</li>
                    <li>Stock actualizado en tiempo real</li>
                    <li>Ubicación de distribuidores en vivo</li>
                    <li>Notificaciones inmediatas</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-shield-alt"></i> SEGURIDAD TOTAL</h3>
                <p>Datos protegidos con encriptación de extremo a extremo. Cada empresa solo ve su información.</p>
                <ul>
                    <li>Separación de datos por empresa</li>
                    <li>Roles y permisos granulares</li>
                    <li>Backup automático diario</li>
                    <li>Cumplimiento normativo boliviano</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-chart-bar"></i> REPORTES AVANZADOS</h3>
                <p>Análisis detallado de cada aspecto del negocio. Toma decisiones basadas en datos reales.</p>
                <ul>
                    <li>Panel ejecutivo personalizable</li>
                    <li>Reportes financieros automáticos</li>
                    <li>Análisis de ventas por zona</li>
                    <li>Proyecciones y tendencias</li>
                </ul>
            </div>
            
            <div class="cyber-card">
                <h3><i class="fas fa-cogs"></i> INTEGRACIÓN COMPLETA</h3>
                <p>Todas las áreas conectadas entre sí. Finanzas ve lo de ventas, ventas ve lo de almacén.</p>
                <ul>
                    <li>Flujo de trabajo automatizado</li>
                    <li>Aprobaciones electrónicas</li>
                    <li>Comunicación entre áreas</li>
                    <li>Historial completo de operaciones</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- BLOQUE: FOOTER -->
    <footer class="cyber-footer">
        <div class="cyber-logo" style="justify-content: center; margin-bottom: 1rem;">
            <i class="fas fa-brain"></i>
            NEXIAL SUITE
        </div>
        <p style="opacity: 0.8; margin-bottom: 2rem;">Sistema de Gestión Empresarial Integral</p>
        
        <div style="display: flex; justify-content: center; gap: 2rem; margin: 2rem 0; flex-wrap: wrap;">
            <a href="#inicio" style="color: var(--secondary); text-decoration: none;">Inicio</a>
            <a href="#caracteristicas" style="color: var(--secondary); text-decoration: none;">Sistema</a>
            <a href="#ventajas" style="color: var(--secondary); text-decoration: none;">Ventajas</a>
            <a href="#" onclick="openRegisterModal()" style="color: var(--secondary); text-decoration: none;">Registro</a>
            <a href="#" onclick="openLoginModal()" style="color: var(--secondary); text-decoration: none;">Acceso</a>
        </div>
        
        <p>© 2025 Nexial Suite. Todos los derechos reservados.</p>
        <p style="margin-top: 1rem; opacity: 0.7;">
            <i class="fas fa-envelope"></i> marcelodanielcc@gmail.com
        </p>
        <p style="margin-top: 0.5rem; opacity: 0.6; font-size: 0.9rem;">
            Conectado a Google Sheets en tiempo real
        </p>
        <p style="margin-top: 0.5rem; opacity: 0.5; font-size: 0.8rem;">
            <span class="professional-id">ID: EMP-NEX-0001</span> • <span class="company-code-badge code-nex">NEX</span>
        </p>
    </footer>

    <!-- ============================================= -->
    <!-- MODALES DEL SISTEMA -->
    <!-- ============================================= -->

    <!-- MODAL: LOGIN -->
    <div class="cyber-modal" id="loginModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeLoginModal()">×</button>
            
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> ACCESO AL SISTEMA</h2>
                <p style="color: rgba(255,255,255,0.7);">Ingresa con tus credenciales</p>
            </div>
            
            <div class="alert" id="loginAlert"></div>
            
            <div class="form-group">
                <label><i class="fas fa-user"></i> Usuario o Email</label>
                <input type="text" id="loginUser" placeholder="usuario@empresa.com" autofocus>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-key"></i> Contraseña</label>
                <div class="password-wrapper">
                    <input type="password" id="loginPass" placeholder="Tu contraseña">
                    <button type="button" class="toggle-password" onclick="togglePassword('loginPass')">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div style="text-align: right; margin: 1rem 0;">
                <a href="#" onclick="recoverPassword()" style="color: var(--primary); text-decoration: none;">
                    <i class="fas fa-unlock-alt"></i> ¿Olvidaste tu contraseña?
                </a>
            </div>
            
            <button class="cyber-btn" style="width: 100%; padding: 1rem; font-size: 1.1rem;" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> INGRESAR AL SISTEMA
            </button>
            
            <div style="text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <p style="color: rgba(255,255,255,0.7);">¿No tienes cuenta?</p>
                <button class="cyber-btn btn-secondary" onclick="closeLoginModal(); openRegisterModal();" style="width: 100%; margin-top: 0.5rem;">
                    <i class="fas fa-building"></i> REGISTRAR EMPRESA
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTRO DE EMPRESA -->
    <div class="cyber-modal" id="registerModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeRegisterModal()">×</button>
            
            <div class="modal-header">
                <h2><i class="fas fa-building"></i> REGISTRO DE EMPRESA</h2>
                <p style="color: rgba(255,255,255,0.7);">Completa los datos de tu empresa</p>
            </div>
            
            <div class="info-banner">
                <h3><i class="fas fa-gift"></i> 30 DÍAS DE PRUEBA GRATUITA</h3>
                <p>Regístrate hoy y obtén acceso completo por 30 días sin costo</p>
            </div>
            
            <div class="alert" id="registerAlert"></div>
            
            <form id="registerForm" onsubmit="registerCompany(event)">
                <!-- ID de empresa generado automáticamente -->
                <div class="form-group" style="display: none;">
                    <label><i class="fas fa-id-badge"></i> ID de Empresa</label>
                    <input type="text" id="generatedCompanyId" readonly>
                    <small style="color: rgba(255,255,255,0.6);">Generado automáticamente</small>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-building"></i> Razón Social *</label>
                    <input type="text" id="companyName" required placeholder="Ej: Mi Empresa S.A." oninput="actualizarCodigoEmpresa()">
                    <div style="margin-top: 0.5rem;">
                        <small style="color: var(--secondary);">
                            <i class="fas fa-info-circle"></i> 
                            Código: <span id="companyCodePreview" class="company-code-badge code-nex">NEX</span>
                            ID: <span id="companyIdPreview" class="professional-id">EMP-NEX-0001</span>
                        </small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Documento de Identificación *</label>
                    <select id="docType" required>
                        <option value="">Seleccionar tipo</option>
                        <option value="NIT">NIT (Bolivia)</option>
                        <option value="RUC">RUC (Perú)</option>
                        <option value="RUT">RUT (Chile)</option>
                        <option value="CUIT">CUIT/CUIL (Argentina)</option>
                        <option value="CNPJ">CNPJ (Brasil)</option>
                        <option value="NIE">NIE/DNI (España)</option>
                        <option value="RFC">RFC (México)</option>
                        <option value="RIF">RIF (Venezuela)</option>
                        <option value="NIT">NIT (Colombia)</option>
                        <option value="EIN">EIN (EE.UU.)</option>
                        <option value="OTRO">Otro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-hashtag"></i> Número de Documento *</label>
                    <input type="text" id="companyDocNumber" required placeholder="Ingrese el número de documento">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-industry"></i> Tipo de Industria *</label>
                    <select id="companyIndustry" required>
                        <option value="">Seleccionar industria</option>
                        <option value="Tecnología">Tecnología</option>
                        <option value="Comercio">Comercio</option>
                        <option value="Manufactura">Manufactura</option>
                        <option value="Servicios">Servicios</option>
                        <option value="Alimentos">Alimentos</option>
                        <option value="Construcción">Construcción</option>
                        <option value="Mineria">Minería</option>
                        <option value="Agricultura">Agricultura</option>
                        <option value="Turismo">Turismo</option>
                        <option value="Otros">Otros</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Nombres *</label>
                    <input type="text" id="names" required placeholder="Ingrese sus nombres completos">
                </div>
                
                <div class="name-grid">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Primer Apellido *</label>
                        <input type="text" id="firstLastName" required placeholder="Apellido paterno">
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Segundo Apellido</label>
                        <input type="text" id="secondLastName" placeholder="Apellido materno">
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email Corporativo *</label>
                    <input type="email" id="companyEmail" required placeholder="contacto@empresa.com">
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-phone"></i> Teléfono/Celular *</label>
                    <div class="phone-container">
                        <div class="form-group country-code">
                            <select id="countryCode" required>
                                <option value="+591">+591 (BO)</option>
                                <option value="+51">+51 (PE)</option>
                                <option value="+56">+56 (CL)</option>
                                <option value="+54">+54 (AR)</option>
                                <option value="+55">+55 (BR)</option>
                                <option value="+57">+57 (CO)</option>
                                <option value="+58">+58 (VE)</option>
                                <option value="+52">+52 (MX)</option>
                                <option value="+1">+1 (US/CA)</option>
                                <option value="+34">+34 (ES)</option>
                                <option value="+49">+49 (DE)</option>
                                <option value="+33">+33 (FR)</option>
                                <option value="+44">+44 (UK)</option>
                            </select>
                        </div>
                        <div class="form-group phone-number">
                            <input type="tel" id="companyPhone" required placeholder="60000000">
                        </div>
                    </div>
                </div>
                
                <!-- ID de usuario jefe generado automáticamente -->
                <div class="form-group" style="display: none;">
                    <label><i class="fas fa-user-tie"></i> ID Usuario Jefe</label>
                    <input type="text" id="generatedJefeId" readonly>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-key"></i> Contraseña Administrador *</label>
                    <div class="password-wrapper">
                        <input type="password" id="adminPassword" required minlength="8" placeholder="Mínimo 8 caracteres">
                        <button type="button" class="toggle-password" onclick="togglePassword('adminPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-key"></i> Confirmar Contraseña *</label>
                    <div class="password-wrapper">
                        <input type="password" id="confirmPassword" required minlength="8" placeholder="Repita su contraseña">
                        <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="termsCheckbox" required>
                    <label for="termsCheckbox">
                        Acepto los <a href="#" onclick="showTerms()">términos y condiciones</a> del servicio y autorizo el tratamiento de mis datos según la normativa aplicable.
                    </label>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="cyber-btn btn-secondary" onclick="closeRegisterModal()">
                        Cancelar
                    </button>
                    <button type="submit" class="cyber-btn">
                        <i class="fas fa-check-circle"></i> REGISTRAR EMPRESA
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // =============================================
        // REGIÓN: CONFIGURACIÓN GLOBAL
        // =============================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbxTK2meeovTdUMq0chUIvOS1Bb27uRPKxhsBk_xWPYzx0BymMed8a7Uv-uMTpGHYG8/exec';
        
        // Configuración de nomenclatura profesional
        const PROFESSIONAL_CONFIG = {
            // Códigos de empresa predefinidos
            companyCodes: {
                'coca cola': 'COC',
                'delux': 'DLX',
                'hp': 'HPP',
                'nexial suite': 'NEX'
            },
            
            // Roles profesionales
            professionalRoles: {
                'super': 'CEO Corporativo',
                'jefe': 'Director Ejecutivo',
                'comercial': 'Director de Operaciones',
                'admin': 'Director Financiero',
                'vendedor': 'Vendedor App',
                'almacen': 'Almacén App'
            },
            
            // Roles técnicos (para compatibilidad)
            technicalRoles: {
                'CEO Corporativo': 'super',
                'Director Ejecutivo': 'jefe',
                'Director de Operaciones': 'comercial',
                'Director Financiero': 'admin',
                'Vendedor App': 'vendedor',
                'Almacén App': 'almacen'
            },
            
            // Formato de IDs
            idFormats: {
                empresa: 'EMP-{CODE}-{NUM}',
                usuario: 'USR-{CODE}-{NUM}',
                empleado: 'EMP-{CODE}-{NUM}'
            }
        };
        
        // =============================================
        // MÓDULO: UTILIDADES DE NOMENCLATURA PROFESIONAL
        // =============================================
        
        // FUNCIÓN: Generar código de empresa (3 letras)
        function generateCompanyCode(companyName) {
            if (!companyName) return 'NEX';
            
            const nameLower = companyName.toLowerCase().trim();
            
            // Buscar en códigos predefinidos
            for (const [name, code] of Object.entries(PROFESSIONAL_CONFIG.companyCodes)) {
                if (nameLower.includes(name)) {
                    return code;
                }
            }
            
            // Generar código de 3 letras
            let code = 'NEX';
            if (nameLower.length >= 3) {
                // Tomar las 3 primeras letras y convertir a mayúsculas
                code = nameLower.substring(0, 3).toUpperCase();
                
                // Si hay espacios, usar iniciales
                const words = nameLower.split(' ');
                if (words.length >= 2) {
                    code = (words[0].charAt(0) + words[1].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
                }
            }
            
            return code;
        }
        
        // FUNCIÓN: Obtener nombre de rol profesional
        function getProfessionalRole(technicalRole) {
            return PROFESSIONAL_CONFIG.professionalRoles[technicalRole] || technicalRole;
        }
        
        // FUNCIÓN: Obtener rol técnico desde profesional
        function getTechnicalRole(professionalRole) {
            return PROFESSIONAL_CONFIG.technicalRoles[professionalRole] || professionalRole;
        }
        
        // FUNCIÓN: Generar ID profesional para empresa
        async function generateCompanyId(companyName) {
            try {
                const code = generateCompanyCode(companyName);
                
                // Llamar a API para obtener el siguiente número
                const response = await fetch(`${API_URL}?action=generarIdEmpresa&nombre=${encodeURIComponent(companyName)}&_t=${Date.now()}`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        return result.id;
                    }
                }
                
                // Fallback: generar localmente
                const companiesCount = await countCompanies();
                const companyNumber = companiesCount + 1;
                return `EMP-${code}-${companyNumber.toString().padStart(4, '0')}`;
                
            } catch (error) {
                console.error('Error generando ID empresa:', error);
                // Fallback extremo
                const code = generateCompanyCode(companyName);
                return `EMP-${code}-0001`;
            }
        }
        
        // FUNCIÓN: Generar ID profesional para usuario
        async function generateUserId(companyId, companyName) {
            try {
                const code = generateCompanyCode(companyName);
                
                // Llamar a API para obtener el siguiente número
                const response = await fetch(`${API_URL}?action=generarIdUsuario&empresa_id=${encodeURIComponent(companyId)}&_t=${Date.now()}`);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        return result.id;
                    }
                }
                
                // Fallback: contar usuarios de esta empresa
                const userCount = await countUsersByCompany(companyId);
                const userNumber = userCount + 1;
                return `USR-${code}-${userNumber.toString().padStart(6, '0')}`;
                
            } catch (error) {
                console.error('Error generando ID usuario:', error);
                // Fallback extremo
                const code = generateCompanyCode(companyName);
                return `USR-${code}-000001`;
            }
        }
        
        // FUNCIÓN: Contar empresas (para fallback)
        async function countCompanies() {
            try {
                const response = await fetch(`${API_URL}?action=getEmpresas&_t=${Date.now()}`);
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.empresas) {
                        return result.empresas.length;
                    }
                }
            } catch (error) {
                console.error('Error contando empresas:', error);
            }
            return 0;
        }
        
        // FUNCIÓN: Contar usuarios por empresa (para fallback)
        async function countUsersByCompany(companyId) {
            try {
                const response = await fetch(`${API_URL}?action=getUsuarios&empresa_id=${encodeURIComponent(companyId)}&_t=${Date.now()}`);
                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.usuarios) {
                        return result.usuarios.length;
                    }
                }
            } catch (error) {
                console.error('Error contando usuarios:', error);
            }
            return 0;
        }
        
        // FUNCIÓN: Actualizar vista previa del código de empresa
        function actualizarCodigoEmpresa() {
            const companyName = document.getElementById('companyName').value;
            if (!companyName) return;
            
            const code = generateCompanyCode(companyName);
            const previewElement = document.getElementById('companyCodePreview');
            const idPreviewElement = document.getElementById('companyIdPreview');
            
            // Actualizar badge
            previewElement.textContent = code;
            previewElement.className = 'company-code-badge';
            
            // Asignar clase de color según código
            switch(code) {
                case 'COC': previewElement.classList.add('code-coc'); break;
                case 'DLX': previewElement.classList.add('code-dlx'); break;
                case 'HPP': previewElement.classList.add('code-hpp'); break;
                case 'NEX': previewElement.classList.add('code-nex'); break;
                default: previewElement.classList.add('code-nex');
            }
            
            // Actualizar ID preview
            idPreviewElement.textContent = `EMP-${code}-0001`;
            
            // Generar ID real para el campo oculto
            generateCompanyId(companyName).then(companyId => {
                document.getElementById('generatedCompanyId').value = companyId;
                
                // También generar ID para el jefe
                const names = document.getElementById('names').value;
                const lastName = document.getElementById('firstLastName').value;
                if (names && lastName) {
                    generateUserId(companyId, companyName).then(userId => {
                        document.getElementById('generatedJefeId').value = userId;
                    });
                }
            });
        }
        
        // =============================================
        // MÓDULO: UTILIDADES VISUALES
        // =============================================
        
        // FUNCIÓN: Crear partículas de fondo
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.width = Math.random() * 4 + 1 + 'px';
                particle.style.height = particle.style.width;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = Math.random() * 20 + 10 + 's';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // FUNCIÓN: Mostrar loading
        function showLoading() {
            document.getElementById('globalLoading').style.display = 'flex';
        }
        
        // FUNCIÓN: Ocultar loading
        function hideLoading() {
            document.getElementById('globalLoading').style.display = 'none';
        }
        
        // FUNCIÓN: Mostrar alerta
        function showAlert(elementId, type, message) {
            const alertElement = document.getElementById(elementId);
            alertElement.className = `alert alert-${type}`;
            alertElement.innerHTML = message;
            alertElement.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    alertElement.style.display = 'none';
                }, 5000);
            }
        }
        
        // =============================================
        // MÓDULO: MANEJO DE MODALES
        // =============================================
        
        // FUNCIÓN: Abrir modal de login
        function openLoginModal() {
            closeAllModals();
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('loginUser').focus();
            document.body.style.overflow = 'hidden';
        }
        
        // FUNCIÓN: Cerrar modal de login
        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginAlert').style.display = 'none';
            document.getElementById('loginUser').value = '';
            document.getElementById('loginPass').value = '';
            document.body.style.overflow = 'auto';
        }
        
        // FUNCIÓN: Abrir modal de registro
        function openRegisterModal() {
            closeAllModals();
            document.getElementById('registerModal').style.display = 'flex';
            document.getElementById('companyName').focus();
            document.body.style.overflow = 'hidden';
            
            // Generar preview inicial
            setTimeout(() => {
                actualizarCodigoEmpresa();
            }, 100);
        }
        
        // FUNCIÓN: Cerrar modal de registro
        function closeRegisterModal() {
            const modal = document.getElementById('registerModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
                document.getElementById('registerAlert').style.display = 'none';
                document.getElementById('registerForm').reset();
                document.body.style.overflow = 'auto';
            }
        }
        
        // FUNCIÓN: Cerrar todos los modales
        function closeAllModals() {
            const loginModal = document.getElementById('loginModal');
            if (loginModal.style.display === 'flex') {
                closeLoginModal();
            }
        }
        
        // =============================================
        // MÓDULO: FUNCIONES DEL FORMULARIO
        // =============================================
        
        // FUNCIÓN: Mostrar/ocultar contraseña
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const button = field.parentElement.querySelector('.toggle-password');
            const icon = button.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // FUNCIÓN: Mostrar términos y condiciones
        function showTerms() {
            alert('TÉRMINOS Y CONDICIONES NEXIAL SUITE\n\n1. Uso exclusivo para empresas registradas\n2. Los datos serán tratados conforme a las leyes de protección de datos del país correspondiente\n3. Período de prueba gratuito de 30 días\n4. Cancelación en cualquier momento desde el panel de control\n5. Responsabilidad del usuario sobre la veracidad de los datos proporcionados\n6. Nexial Suite se reserva el derecho de suspender cuentas con información falsa\n\nPara ver los términos completos, contacte a soporte: marcelodanielcc@gmail.com');
            return false;
        }
        
        // =============================================
        // MÓDULO: REGISTRO DE EMPRESA (ACTUALIZADO)
        // =============================================
        
        // FUNCIÓN: Procesar registro de empresa
        async function registerCompany(event) {
          event.preventDefault();
          showLoading();
          
          // Validar contraseñas
          const password = document.getElementById('adminPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          
          if (password !== confirmPassword) {
            showAlert('registerAlert', 'error', 'Las contraseñas no coinciden');
            hideLoading();
            return;
          }
          
          if (password.length < 8) {
            showAlert('registerAlert', 'error', 'La contraseña debe tener mínimo 8 caracteres');
            hideLoading();
            return;
          }
          
          // Obtener IDs generados
          const companyId = document.getElementById('generatedCompanyId').value;
          const jefeId = document.getElementById('generatedJefeId').value;
          
          // Si no hay IDs generados, generarlos ahora
          let finalCompanyId = companyId;
          let finalJefeId = jefeId;
          
          if (!finalCompanyId) {
            const companyName = document.getElementById('companyName').value.trim();
            finalCompanyId = await generateCompanyId(companyName);
          }
          
          if (!finalJefeId) {
            const companyName = document.getElementById('companyName').value.trim();
            finalJefeId = await generateUserId(finalCompanyId, companyName);
          }
          
          // Recopilar datos
          const countryCode = document.getElementById('countryCode').value;
          const phoneNumber = document.getElementById('companyPhone').value;
          
          const companyData = {
            action: 'registerCompany',
            company_id: finalCompanyId, // Nuevo campo con ID profesional
            nombre: document.getElementById('companyName').value.trim(),
            tipo_documento: document.getElementById('docType').value,
            numero_documento: document.getElementById('companyDocNumber').value.trim(),
            industria: document.getElementById('companyIndustry').value,
            nombres: document.getElementById('names').value.trim(),
            primer_apellido: document.getElementById('firstLastName').value.trim(),
            segundo_apellido: document.getElementById('secondLastName').value.trim() || '',
            email: document.getElementById('companyEmail').value.trim().toLowerCase(),
            telefono: countryCode + ' ' + phoneNumber,
            password: password,
            jefe_id: finalJefeId, // Nuevo campo con ID profesional del jefe
            role: 'Director Ejecutivo' // Rol profesional
          };
          
          // Validar campos requeridos
          const requiredFields = ['nombre', 'tipo_documento', 'numero_documento', 'industria', 
                                'nombres', 'primer_apellido', 'email', 'telefono'];
          
          for (const field of requiredFields) {
            if (!companyData[field]) {
              const fieldNames = {
                'nombre': 'Razón Social',
                'tipo_documento': 'Tipo de Documento',
                'numero_documento': 'Número de Documento',
                'industria': 'Tipo de Industria',
                'nombres': 'Nombres',
                'primer_apellido': 'Primer Apellido',
                'email': 'Email Corporativo',
                'telefono': 'Teléfono/Celular'
              };
              showAlert('registerAlert', 'error', `Por favor complete el campo: ${fieldNames[field] || field}`);
              hideLoading();
              return;
            }
          }
          
          // Validar documento
          const docNumber = companyData.numero_documento;
          if (!docNumber || docNumber.trim() === '' || docNumber.length < 3) {
            showAlert('registerAlert', 'error', 'Por favor ingrese un número de documento válido');
            hideLoading();
            return;
          }
          
          // Validar email
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(companyData.email)) {
            showAlert('registerAlert', 'error', 'Por favor ingrese un email válido');
            hideLoading();
            return;
          }
          
          // Validar teléfono
          const phoneDigits = phoneNumber.replace(/\D/g, '');
          if (phoneDigits.length < 7) {
            showAlert('registerAlert', 'error', 'Por favor ingrese un número de teléfono válido (mínimo 7 dígitos)');
            hideLoading();
            return;
          }
          
          try {
            console.log('Enviando datos de registro profesional:', companyData);
            
            // Usar GET para evitar problemas CORS (más compatible con Apps Script)
            const params = new URLSearchParams(companyData).toString();
            const url = `${API_URL}?${params}`;
            
            console.log('URL completa:', url);
            
            const response = await fetch(url, {
              method: 'GET',
              mode: 'no-cors', // Importante para evitar problemas CORS
              cache: 'no-cache'
            });
            
            // En modo no-cors no podemos leer la respuesta directamente
            // Esperar 2 segundos para que el registro se procese
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Generar email para el jefe automáticamente
            const emailJefe = companyData.nombres.toLowerCase().split(' ')[0] + '.' + 
                             companyData.primer_apellido.toLowerCase().replace(/\s+/g, '') + '@' + 
                             (companyData.email.split('@')[1] || 'nexialsuite.com');
            
            hideLoading();
            
            // Mostrar mensaje de éxito con las credenciales PROFESIONALES
            showAlert('registerAlert', 'success', 
              '✅ ¡Registro exitoso!<br><br>' +
              'Tu empresa ha sido registrada con nomenclatura profesional.<br><br>' +
              '<strong>Información de la empresa:</strong><br>' +
              '🏢 ID Empresa: <span class="professional-id">' + finalCompanyId + '</span><br>' +
              '👤 ID Jefe: <span class="professional-id">' + finalJefeId + '</span><br><br>' +
              '<strong>Credenciales de acceso:</strong><br>' +
              '📧 Email: ' + emailJefe + '<br>' +
              '🔑 Contraseña: ' + password + '<br>' +
              '👔 Rol: Director Ejecutivo<br><br>' +
              'Puedes iniciar sesión ahora con estas credenciales.');
            
            // Limpiar formulario después de 5 segundos y redirigir al login
            setTimeout(() => {
              document.getElementById('registerForm').reset();
              closeRegisterModal();
              openLoginModal();
              // Rellenar el email en el login
              document.getElementById('loginUser').value = emailJefe;
              document.getElementById('loginPass').focus();
            }, 5000);
            
          } catch (error) {
            console.error('Error en registro:', error);
            hideLoading();
            
            // Generar email para el jefe de todas formas
            const emailJefe = companyData.nombres.toLowerCase().split(' ')[0] + '.' + 
                             companyData.primer_apellido.toLowerCase().replace(/\s+/g, '') + '@' + 
                             (companyData.email.split('@')[1] || 'nexialsuite.com');
            
            // Mostrar mensaje de éxito aunque haya error de conexión
            showAlert('registerAlert', 'success', 
              '✅ ¡Registro procesado!<br><br>' +
              'Tu solicitud ha sido recibida.<br><br>' +
              '<strong>Información generada:</strong><br>' +
              '🏢 ID Empresa: <span class="professional-id">' + finalCompanyId + '</span><br>' +
              '👤 ID Jefe: <span class="professional-id">' + finalJefeId + '</span><br><br>' +
              '<strong>Credenciales de acceso:</strong><br>' +
              '📧 Email: ' + emailJefe + '<br>' +
              '🔑 Contraseña: ' + password + '<br>' +
              '👔 Rol: Director Ejecutivo<br><br>' +
              'Intenta iniciar sesión con estas credenciales.');
            
            // Limpiar formulario después de 5 segundos
            setTimeout(() => {
              document.getElementById('registerForm').reset();
              closeRegisterModal();
              openLoginModal();
              document.getElementById('loginUser').value = emailJefe;
              document.getElementById('loginPass').focus();
            }, 5000);
          }
        }
        
        // =============================================
        // MÓDULO: LOGIN DEL SISTEMA (ACTUALIZADO)
        // =============================================
        
        // FUNCIÓN: Procesar login
        async function login() {
            const user = document.getElementById('loginUser').value.trim();
            const password = document.getElementById('loginPass').value;
            
            if (!user || !password) {
                showAlert('loginAlert', 'error', 'Por favor complete todos los campos');
                return;
            }
            
            showLoading();
            
            try {
                // Preparar datos para la API
                const loginData = {
                    action: 'login',
                    email: user,
                    password: password
                };
                
                console.log('Enviando datos de login:', loginData);
                
                // Usando POST
                const formData = new URLSearchParams();
                formData.append('action', 'login');
                formData.append('email', user);
                formData.append('password', password);
                
                const response = await fetch(API_URL, {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData
                });
                
                // Si POST falla, usar GET
                if (!response.ok) {
                    console.log('POST falló, intentando GET...');
                    const getResponse = await fetch(`${API_URL}?action=login&email=${encodeURIComponent(user)}&password=${encodeURIComponent(password)}&_t=${Date.now()}`);
                    
                    if (getResponse.ok) {
                        const result = await getResponse.json();
                        processLoginResponse(result);
                        return;
                    }
                } else {
                    const result = await response.json();
                    processLoginResponse(result);
                    return;
                }
                
                // Si ambas fallan, probar con super admin
                if (user === 'marcelodanielcc@gmail.com' && password === '789') {
                    processLoginResponse({
                        success: true,
                        user: {
                            id: 'USR-NEX-000001',
                            email: 'marcelodanielcc@gmail.com',
                            nombre: 'Marcelo Daniel Condori',
                            role: 'CEO Corporativo',
                            empresa: 'Nexial Suite',
                            empresa_id: 'EMP-NEX-0001',
                            activo: 'Sí'
                        }
                    });
                    return;
                }
                
                throw new Error('No se pudo conectar con el servidor');
                
            } catch (error) {
                console.error('Error en login:', error);
                hideLoading();
                showAlert('loginAlert', 'error', 
                    'Error de conexión. Por favor verifica tu internet o contacta a soporte.');
            }
        }
        
        // FUNCIÓN: Procesar respuesta de login
        function processLoginResponse(result) {
            hideLoading();
            
            if (result && result.success) {
                // Convertir rol técnico a profesional si es necesario
                if (result.user.role && PROFESSIONAL_CONFIG.professionalRoles[result.user.role]) {
                    result.user.role = PROFESSIONAL_CONFIG.professionalRoles[result.user.role];
                }
                
                // Guardar datos de usuario
                localStorage.setItem('nexial_user', JSON.stringify(result.user));
                
                // Redirigir al dashboard
                closeLoginModal();
                window.location.href = 'dashboard.html';
            } else {
                // Probar con super admin como respaldo
                const user = document.getElementById('loginUser').value.trim();
                const password = document.getElementById('loginPass').value;
                
                if (user === 'marcelodanielcc@gmail.com' && password === '789') {
                    localStorage.setItem('nexial_user', JSON.stringify({
                        id: 'USR-NEX-000001',
                        email: 'marcelodanielcc@gmail.com',
                        nombre: 'Marcelo Daniel Condori',
                        role: 'CEO Corporativo',
                        empresa: 'Nexial Suite',
                        empresa_id: 'EMP-NEX-0001',
                        activo: 'Sí'
                    }));
                    closeLoginModal();
                    window.location.href = 'dashboard.html';
                } else {
                    showAlert('loginAlert', 'error', result?.error || 'Usuario o contraseña incorrectos');
                }
            }
        }
        
        // =============================================
        // MÓDULO: FUNCIONES AUXILIARES
        // =============================================
        
        // FUNCIÓN: Recuperar contraseña
        function recoverPassword() {
            const email = prompt('Ingrese su email para recuperar contraseña:');
            if (email) {
                alert(`Se ha enviado un enlace de recuperación a: ${email}\n\nRevise su bandeja de entrada.`);
            }
        }
        
        // FUNCIÓN: Validar documento mientras se escribe
        function setupDocumentValidation() {
            const docInput = document.getElementById('companyDocNumber');
            if (docInput) {
                docInput.addEventListener('input', function(e) {
                    // Permitir solo números, letras y guiones
                    this.value = this.value.replace(/[^a-zA-Z0-9-]/g, '');
                });
            }
        }
        
        // FUNCIÓN: Validar teléfono mientras se escribe
        function setupPhoneValidation() {
            const phoneInput = document.getElementById('companyPhone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    // Permitir solo números
                    this.value = this.value.replace(/\D/g, '');
                });
            }
        }
        
        // FUNCIÓN: Ejecutar migración del sistema
        async function executeMigration() {
            if (confirm('¿Estás seguro de ejecutar la migración a nomenclatura profesional?\n\nEsta acción actualizará todos los IDs en Google Sheets.')) {
                showLoading();
                try {
                    const response = await fetch(`${API_URL}?action=migrarSistema&_t=${Date.now()}`);
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            alert('✅ Migración completada exitosamente!\n\n' +
                                  `Empresas migradas: ${result.data?.empresas?.length || 0}\n` +
                                  `Usuarios migrados: ${result.data?.usuarios?.length || 0}\n` +
                                  `Empleados migrados: ${result.data?.empleados?.length || 0}`);
                        } else {
                            alert('❌ Error en migración: ' + (result.error || 'Desconocido'));
                        }
                    } else {
                        alert('❌ Error de conexión con la API');
                    }
                } catch (error) {
                    alert('❌ Error: ' + error.message);
                } finally {
                    hideLoading();
                }
            }
        }
        
        // =============================================
        // EVENT LISTENERS
        // =============================================
        
        // Enter para login
        document.getElementById('loginPass')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') login();
        });
        
        // Permitir cierre de modales al hacer clic fuera
        document.getElementById('loginModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeLoginModal();
            }
        });
        
        document.getElementById('registerModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeRegisterModal();
            }
        });
        
        // Actualizar código de empresa cuando cambia el nombre
        document.getElementById('companyName')?.addEventListener('input', actualizarCodigoEmpresa);
        
        // Generar ID para jefe cuando se ingresan nombres
        document.getElementById('names')?.addEventListener('input', function() {
            const companyName = document.getElementById('companyName').value;
            const companyId = document.getElementById('generatedCompanyId').value;
            if (companyName && companyId) {
                generateUserId(companyId, companyName).then(userId => {
                    document.getElementById('generatedJefeId').value = userId;
                });
            }
        });
        
        // =============================================
        // INICIALIZACIÓN
        // =============================================
        
        // FUNCIÓN: Inicializar aplicación
        function initializeApp() {
            createParticles();
            setupDocumentValidation();
            setupPhoneValidation();
            
            console.log('🚀 Nexial Suite - Sistema Empresarial');
            console.log('📊 Versión: 4.0 (Nomenclatura Profesional)');
            console.log('🔗 API URL:', API_URL);
            console.log('📁 Google Sheets ID: 15lTP0GBO0RKeIKBvAmC-8UFijJKOcawYzjhO5CCndRo');
            console.log('🎯 Configuración profesional activada');
            
            // Verificar si hay usuario guardado
            const savedUser = localStorage.getItem('nexial_user');
            if (savedUser) {
                console.log('👤 Usuario encontrado en sesión');
            }
            
            // Inicializar PWA si está disponible
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('✅ Service Worker registrado:', reg))
                    .catch(err => console.log('❌ Error Service Worker:', err));
            }
            
            // Agregar botón de migración para desarrollo (solo visible si hay parámetro debug)
            if (window.location.search.includes('debug=true')) {
                const migrationBtn = document.createElement('button');
                migrationBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Migrar Sistema';
                migrationBtn.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: var(--primary);
                    color: white;
                    border: none;
                    padding: 10px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    z-index: 9999;
                `;
                migrationBtn.onclick = executeMigration;
                document.body.appendChild(migrationBtn);
            }
        }
        
        // EVENTO: Cargar página
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

